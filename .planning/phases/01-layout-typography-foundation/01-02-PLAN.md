---
phase: 01-layout-typography-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - layouts/partials/head.html
autonomous: true

must_haves:
  truths:
    - "Variable font loads with full weight range (100-900)"
    - "Light theme displays by default on first visit"
    - "Dark mode toggle still works correctly"
    - "System dark mode preference is respected for new visitors"
  artifacts:
    - path: "layouts/partials/head.html"
      provides: "Variable font loading, light-default theme logic"
      contains: "inter:100..900"
  key_links:
    - from: "layouts/partials/head.html"
      to: "localStorage.theme"
      via: "theme initialization script"
      pattern: "localStorage.theme"
    - from: "layouts/partials/head.html"
      to: "fonts.bunny.net"
      via: "variable font link"
      pattern: "100\\.\\.900"
---

<objective>
Switch to variable font loading for performance and implement light-as-default theme logic.

Purpose: Variable fonts reduce HTTP requests and file size (one file vs multiple weights). Light default matches user's minimal aesthetic preference while preserving dark mode for those who want it.

Output: Updated head.html with variable font URL and inverted theme initialization logic.
</objective>

<execution_context>
@/home/dan/.claude/get-shit-done/workflows/execute-plan.md
@/home/dan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-layout-typography-foundation/01-RESEARCH.md

Source file to modify:
@layouts/partials/head.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Switch to variable font loading</name>
  <files>layouts/partials/head.html</files>
  <action>
Replace the current font loading with variable font syntax.

Current (separate weights):
```html
<link rel="preconnect" href="https://fonts.bunny.net">
<link href="https://fonts.bunny.net/css?family=inter:400,500,600,700|jetbrains-mono:400,500" rel="stylesheet">
```

Updated (variable font with weight range):
```html
<link rel="preconnect" href="https://fonts.bunny.net">
<link href="https://fonts.bunny.net/css?family=inter:100..900|jetbrains-mono:400,500" rel="stylesheet">
```

The `100..900` syntax requests the variable font file with full weight range, allowing any weight from 100 to 900 to be used without additional HTTP requests.

JetBrains Mono stays at fixed weights (400, 500) since we only use it for code blocks at those weights.
  </action>
  <verify>Run `npm run dev`, open DevTools Network tab, filter by "font". Should see one Inter font file, not multiple.</verify>
  <done>head.html font link uses "inter:100..900" variable font syntax instead of separate weights.</done>
</task>

<task type="auto">
  <name>Task 2: Implement light-as-default theme logic</name>
  <files>layouts/partials/head.html</files>
  <action>
Update the dark mode initialization script to default to light theme.

Current logic (dark default):
```html
<script>
  if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }
</script>
```

This says: "Add dark class if user chose dark OR if no preference and system is dark."

Updated logic (light default):
```html
<script>
  // Light is default. Only add dark class if:
  // 1. User explicitly chose dark, OR
  // 2. No stored preference AND system prefers dark
  if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }
</script>
```

Wait - the logic is actually already correct for "light default with system preference respect"! The issue is we need to ensure no 'dark' class exists on the HTML element initially.

The current logic:
- If user stored 'dark' -> add dark class
- If no storage AND system dark -> add dark class
- Otherwise -> remove dark class (light)

This IS light-default behavior. The key is that `<html>` starts without 'dark' class, so if no conditions match, it stays light.

Actually, I need to check if there's an issue elsewhere. The script looks correct. Let me verify the html element doesn't have dark class initially by checking baseof.html.

Looking at baseof.html: `<html lang="{{ .Site.LanguageCode }}" class="scroll-smooth">`

No 'dark' class on html element initially. The script should work correctly.

If the current blog shows dark by default, check if there's old localStorage. For a fresh user, this SHOULD show light.

Since the logic is actually correct, this task becomes a verification + minor improvement (add comment explaining the behavior).

Update the script with clearer comments:
```html
<script>
  // Theme: light by default, dark if user chose it or system prefers dark
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const storedTheme = localStorage.theme;

  if (storedTheme === 'dark' || (!storedTheme && prefersDark)) {
    document.documentElement.classList.add('dark');
  }
  // No else needed - html starts without 'dark' class (light default)
</script>
```

This refactored version is cleaner and makes the light-default behavior explicit. The `classList.remove('dark')` is unnecessary since html never has dark class initially.
  </action>
  <verify>
1. Clear localStorage in browser DevTools (Application > Local Storage > delete 'theme' key)
2. Run `npm run dev` and visit site - should show LIGHT theme
3. If system is set to dark mode, should show DARK (respecting system preference)
4. Toggle to dark, refresh - should stay dark
5. Toggle to light, refresh - should stay light
  </verify>
  <done>Theme script is refactored for clarity. Light theme is default for new visitors. System dark preference is respected. Toggle persists correctly.</done>
</task>

</tasks>

<verification>
After all tasks:
1. `grep -n "100..900" layouts/partials/head.html` confirms variable font
2. `grep -n "prefersDark" layouts/partials/head.html` confirms refactored script
3. `npm run dev` works without errors
4. Fresh browser (incognito) shows light theme
5. Dark mode toggle works bidirectionally
</verification>

<success_criteria>
- Variable font syntax "inter:100..900" used (LAYOUT-04)
- Light theme displays by default for new visitors (LAYOUT-05)
- Dark mode toggle still functional (LAYOUT-05)
- System dark mode preference respected (LAYOUT-05)
- No FOUC (flash of unstyled content) on page load
</success_criteria>

<output>
After completion, create `.planning/phases/01-layout-typography-foundation/01-02-SUMMARY.md`
</output>
