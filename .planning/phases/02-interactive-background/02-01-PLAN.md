---
phase: 02-interactive-background
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - static/js/perlin.js
  - static/js/flow-field-background.js
autonomous: true

must_haves:
  truths:
    - "Canvas renders behind page content without obscuring text"
    - "Particles flow smoothly following noise-driven vectors"
    - "Particles repel from mouse cursor"
  artifacts:
    - path: "static/js/perlin.js"
      provides: "Simplex noise library"
      min_lines: 100
    - path: "static/js/flow-field-background.js"
      provides: "Flow field animation with CONFIG object"
      min_lines: 150
      contains: "const CONFIG"
  key_links:
    - from: "static/js/flow-field-background.js"
      to: "static/js/perlin.js"
      via: "Noise constructor from perlin.js"
      pattern: "new Noise"
---

<objective>
Create the core flow field animation system with Simplex noise-driven particle movement and mouse interaction.

Purpose: Establish the visual foundation for the interactive background - particles flowing through a noise field that responds to mouse cursor.

Output: Two JavaScript files in static/js/ - the noisejs library and the main animation script with a clear CONFIG object at the top.
</objective>

<execution_context>
@/home/dan/.claude/get-shit-done/workflows/execute-plan.md
@/home/dan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-interactive-background/02-RESEARCH.md
@.planning/phases/02-interactive-background/02-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Vendor noisejs library</name>
  <files>static/js/perlin.js</files>
  <action>
Download the noisejs library from https://raw.githubusercontent.com/josephg/noisejs/master/perlin.js and save it to static/js/perlin.js.

Use curl or fetch the file content. The library provides Noise constructor with simplex2/simplex3 methods needed for flow field generation.

Add a comment at the top noting the source: "// noisejs by Joseph Gentle - https://github.com/josephg/noisejs"
  </action>
  <verify>File exists at static/js/perlin.js and contains "Noise" function/class</verify>
  <done>noisejs library available for import in flow field script</done>
</task>

<task type="auto">
  <name>Task 2: Create flow field animation script</name>
  <files>static/js/flow-field-background.js</files>
  <action>
Create the main animation script with these components in order:

1. CONFIG object at very top with all tweakable values:
   - particleCount: 150 (desktop default)
   - particleSize: 2
   - particleColor: '#6366f1' (indigo-500, fits light theme)
   - particleAlpha: 0.6
   - noiseScale: 0.003
   - noiseStrength: 0.5
   - timeIncrement: 0.0003
   - mouseRadius: 120
   - mouseStrength: 3
   - maxSpeed: 1.5
   - trailFade: 0.08

2. Canvas setup function:
   - Create canvas element with id 'flow-field-canvas'
   - Position fixed, inset 0, z-index -1 (behind content)
   - Apply high-DPI scaling using devicePixelRatio
   - Append to document.body as first child

3. Particle pool using object pooling pattern:
   - Pre-allocate particle objects with x, y, vx, vy properties
   - Initialize with random positions across canvas
   - No garbage collection in animation loop

4. Flow field function using Simplex noise:
   - getFlowAngle(x, y, time) using noise.simplex3
   - Map noise (-1 to 1) to angle (0 to 2PI)
   - Use noiseScale and time for evolving patterns

5. Mouse tracking:
   - Store mouseX, mouseY on mousemove (don't process in handler)
   - Reset to off-canvas position on mouseleave
   - Apply repel force in animation loop based on distance

6. Animation loop with requestAnimationFrame:
   - Delta time calculation for frame independence
   - Clear canvas with semi-transparent fill (trail effect)
   - Update each particle: apply flow force, apply mouse repel, limit velocity, update position, wrap edges
   - Draw particles as small circles

7. Initialization:
   - Wait for DOMContentLoaded
   - Create canvas
   - Initialize particles
   - Start animation loop

Key implementation details from research:
- Use simplex3 (not simplex2) for time-evolving patterns
- Distance squared check before sqrt for mouse force (performance)
- Velocity capping to prevent particles shooting off
- Edge wrapping not clamping (seamless flow)
  </action>
  <verify>
File exists and contains:
- CONFIG object with all listed properties
- Canvas creation with z-index: -1
- Noise initialization (new Noise)
- requestAnimationFrame loop
- Mouse event listeners
  </verify>
  <done>Flow field animation runs when script is loaded, particles flow and respond to mouse</done>
</task>

</tasks>

<verification>
1. Both files exist in static/js/
2. flow-field-background.js has CONFIG object as first code block
3. Script creates canvas when run in browser
4. No errors in browser console when loading scripts
</verification>

<success_criteria>
- Canvas element created with fixed positioning behind content
- Particles move smoothly following flow field
- Particles repel from mouse cursor
- Animation runs at stable frame rate
- CONFIG object clearly visible at top of flow-field-background.js
</success_criteria>

<output>
After completion, create `.planning/phases/02-interactive-background/02-01-SUMMARY.md`
</output>
