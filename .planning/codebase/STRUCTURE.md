# Codebase Structure

**Analysis Date:** 2026-01-28

## Directory Layout

```
/home/dan/code/blog/
├── content/              # Blog content (Markdown)
│   ├── posts/            # Blog post collection
│   ├── about.md          # Single page
│   └── _index.md         # Posts section listing page
├── layouts/              # Hugo templates (HTML)
│   ├── _default/         # Default templates for content types
│   ├── partials/         # Reusable template components
│   ├── posts/            # Post-specific templates (if any)
│   └── index.html        # Home page template
├── assets/               # Assets processed by Hugo
│   └── css/
│       └── main.css      # Tailwind directives, custom CSS
├── archetypes/           # Templates for `hugo new` command
│   └── default.md        # Default post template
├── static/               # Static files copied as-is
├── .github/              # GitHub configuration
│   └── workflows/        # CI/CD automation
│       └── deploy.yml    # Build and deploy workflow
├── .planning/            # GSD planning documents
│   └── codebase/         # This folder (generated analysis)
├── public/               # Generated static site (build output)
├── resources/            # Hugo cache and temporary files
├── node_modules/         # npm dependencies
├── hugo.toml             # Hugo configuration
├── package.json          # npm scripts and dependencies
├── package-lock.json     # npm lockfile
├── Dockerfile            # Multi-stage Docker build
├── docker-compose.yml    # Container orchestration config
├── nginx.conf            # nginx web server config
├── tailwind.config.js    # Tailwind CSS configuration
├── postcss.config.js     # PostCSS plugin configuration
├── .gitignore            # Git ignore rules
├── flake.nix             # Nix environment (optional)
├── flake.lock            # Nix lockfile (optional)
├── USAGE.md              # User documentation
└── README files...       # (various node_modules)
```

## Directory Purposes

**`content/`:**
- Purpose: Source of truth for all blog content
- Contains: Markdown (.md) files with YAML frontmatter
- Key files:
  - `content/posts/*.md` - Individual blog posts
  - `content/posts/_index.md` - Index for posts section
  - `content/about.md` - About page
- Versioned in git; changes trigger site rebuilds

**`layouts/`:**
- Purpose: HTML templates that define site structure and appearance
- Contains: Hugo template files (.html) organized by function
- Key files:
  - `layouts/_default/baseof.html` - Base template wrapping all pages
  - `layouts/_default/single.html` - Single post/page template
  - `layouts/_default/list.html` - Post listing template
  - `layouts/index.html` - Home page template
  - `layouts/404.html` - 404 error page
  - `layouts/partials/head.html` - HTML head section (meta, styles)
  - `layouts/partials/header.html` - Navigation header with menu
  - `layouts/partials/footer.html` - Footer with copyright and links
  - `layouts/partials/scripts.html` - JavaScript initialization
- `layouts/posts/` - Post-specific overrides (if needed)

**`assets/css/`:**
- Purpose: Stylesheet source code processed by PostCSS/Tailwind
- Contains: CSS with Tailwind directives
- Key files:
  - `assets/css/main.css` - Entry point for Tailwind, custom CSS, scrollbar styling
- Compiled to final CSS during build

**`archetypes/`:**
- Purpose: Templates for generating new content with `hugo new`
- Contains: Markdown templates with default frontmatter
- Key files:
  - `archetypes/default.md` - Template for new posts (includes title, date, draft, tags, description)
- Not compiled into site; used only as scaffolding

**`static/`:**
- Purpose: Static files copied to output unchanged
- Contains: Images, icons, fonts, any file that needs as-is copying
- Referenced in pages as `/filename.ext`

**`.github/workflows/`:**
- Purpose: GitHub Actions CI/CD automation
- Contains: YAML workflow definitions
- Key files:
  - `.github/workflows/deploy.yml` - Build and deploy to server
    - Builds Docker image on push to main
    - Pushes to GitHub Container Registry
    - SSH into server and runs docker-compose

**`.planning/codebase/`:**
- Purpose: GSD codebase analysis documents
- Generated by GSD tools; should not be edited manually
- Contains: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md, STACK.md, INTEGRATIONS.md

**`public/`:**
- Purpose: Build output - the compiled static site
- Generated by: `npm run build`, `hugo --minify`
- Not versioned (in .gitignore)
- Contains:
  - HTML pages
  - Compiled CSS
  - JavaScript
  - Pagefind search index (`public/pagefind/`)

**`resources/`:**
- Purpose: Hugo cache and build artifacts
- Generated automatically
- Not versioned

## Key File Locations

**Entry Points:**

- `hugo.toml`: Hugo configuration entry point (defines site title, baseURL, menu, pagination, syntax highlighting)
- `package.json`: npm scripts entry point (defines dev, build, build:search commands)
- `Dockerfile`: Docker build entry point (starts with Hugo build stage)
- `.github/workflows/deploy.yml`: CI/CD entry point (triggered by push to main)

**Configuration:**

- `hugo.toml`: Site configuration (title, description, author, baseURL, menu, syntax style)
- `tailwind.config.js`: Tailwind CSS settings (dark mode, custom fonts, typography plugin)
- `postcss.config.js`: PostCSS processing order (tailwindcss, autoprefixer)
- `docker-compose.yml`: Container configuration (image, labels, Traefik routing, networking)
- `nginx.conf`: Web server config (caching, compression, security headers, URL rewrites)

**Core Logic:**

- `layouts/_default/baseof.html`: Global page structure, partial includes, outer HTML
- `layouts/index.html`: Home page layout (hero, recent posts list)
- `layouts/_default/single.html`: Individual post/page layout (header, content, footer navigation)
- `layouts/_default/list.html`: Post archive layout (section title, post listing, pagination)
- `layouts/partials/head.html`: Metadata, fonts, CSS, dark mode initialization
- `layouts/partials/header.html`: Navigation bar with search, dark mode toggle, mobile menu
- `layouts/partials/footer.html`: Copyright, RSS link
- `layouts/partials/scripts.html`: Dark mode toggle, mobile menu, search modal, Pagefind initialization

**Styling:**

- `assets/css/main.css`: Tailwind directives, custom CSS for scrollbar, code blocks, search highlight
- `tailwind.config.js`: Font definitions, dark mode, typography customization

**Testing:**

- No test files - static site doesn't have unit tests

## Naming Conventions

**Files:**

- **Posts:** `content/posts/my-post-title.md` (kebab-case for readability in URLs)
- **Pages:** `content/page-name.md` (kebab-case)
- **Templates:** `layouts/_default/single.html`, `layouts/partials/component-name.html` (lowercase with hyphens for partials)
- **Config:** `hugo.toml`, `tailwind.config.js`, `postcss.config.js` (lowercase, .config pattern for tool configs)
- **Markdown frontmatter keys:** lowercase with no spaces (`title`, `description`, `tags`, `draft`)

**Directories:**

- **Content:** `content/posts/`, `content/pages/` (plural, lowercase)
- **Templates:** `layouts/_default/`, `layouts/partials/` (underscore prefix for Hugo system directories)
- **Assets:** `assets/css/` (plural, asset type subdirectories)
- **Output:** `public/`, `resources/` (Hugo conventions)

**CSS Classes:**

- Tailwind utilities: `text-4xl`, `font-bold`, `dark:bg-gray-900` (kebab-case, vendor prefixes like `dark:`, `sm:`)
- Custom classes: `.highlight pre`, `mark` (rare, used only when Tailwind insufficient)

**Hugo Variables/Functions:**

- Site config: `.Site.Title`, `.Site.Params.description` (PascalCase for dot-notation access)
- Page variables: `.Title`, `.Content`, `.Date`, `.Permalink` (PascalCase)
- Built-in functions: `where`, `range`, `with` (lowercase, Hugo-specific syntax)

## Where to Add New Code

**New Blog Post:**
- Location: `content/posts/my-post-title.md`
- Frontmatter: Use archetype from `archetypes/default.md` as template
- Content: Markdown with headings, code blocks, links
- Testing: Visual preview in `npm run dev`

**New Page (not a post):**
- Location: `content/page-name.md` (in root of content/)
- Frontmatter: Similar to posts, but no tags typically
- Will render with `layouts/_default/single.html` template
- Add menu link in `hugo.toml` under `[[menus.main]]`

**New Template/Layout:**
- For page-specific overrides: `layouts/[section]/[layout-type].html`
- For reusable components: `layouts/partials/component-name.html` and include with `{{ partial "component-name.html" . }}`
- Base structure: All pages inherit from `layouts/_default/baseof.html`
- Context: Access page variables via `.` dot notation

**Custom Styling:**
- **Simple changes:** Add Tailwind classes to HTML in templates
- **Complex styling:** Add custom CSS to `assets/css/main.css` in `@layer components` block
- **Dark mode:** Use `dark:` prefix on Tailwind classes (e.g., `dark:bg-gray-900`)
- **Typography:** Prose styling via `@tailwindcss/typography` plugin (applied to `.prose` class in single.html)

**New Feature (dark mode, search, mobile menu):**
- JavaScript location: `layouts/partials/scripts.html`
- Pattern: Initialize on DOMContentLoaded, use vanilla JS (no framework)
- State management: localStorage for persistence, DOM classes for UI state
- Keyboard shortcuts: Listen to `keydown` events

**Utilities/Helpers:**
- No separate utilities directory (Hugo handles most operations)
- Reusable template logic: Extract to `layouts/partials/` partial
- Content helpers: Use Hugo template functions (where, range, if, with)

## Special Directories

**`node_modules/`:**
- Purpose: npm dependency code
- Generated: Yes (by `npm install`)
- Committed: No (in .gitignore)
- Contains: tailwindcss, postcss, autoprefixer, pagefind
- Clean: `rm -rf node_modules/ && npm install`

**`public/`:**
- Purpose: Compiled static site ready for serving
- Generated: Yes (by `hugo` or `npm run build`)
- Committed: No (in .gitignore)
- Contains: HTML pages, CSS, JS, images, pagefind search index
- Clean: `rm -rf public/` (Hugo recreates on next build)

**`resources/`:**
- Purpose: Hugo build cache and processed assets
- Generated: Yes (by Hugo)
- Committed: No (in .gitignore)
- Contains: Intermediate CSS, compiled templates, asset fingerprints
- Clean: Safe to delete; Hugo will regenerate

**`.git/`:**
- Purpose: Git version control metadata
- Contains: Commit history, branches, remotes
- Always committed: Yes
- Do not edit manually

**`.github/`:**
- Purpose: GitHub-specific configuration
- Committed: Yes (workflows drive CI/CD)
- Contains: GitHub Actions workflows, issue templates (if any)

## Build Artifact Locations

**CSS Output:**
- Generated: During `npm run build` or `npm run dev`
- Location: `resources/_gen/assets/css/` (Hugo cache) → linked in `head.html` via `$css.RelPermalink`
- Fingerprinting: Added in production (integrity hash for subresource integrity)

**Search Index:**
- Generated: By `npm run build:search` (must run after `hugo`)
- Location: `public/pagefind/` (contains pagefind-ui.js, pagefind.js, fragment.* files)
- Accessed: Via `<script src="/pagefind/pagefind-ui.js"></script>` in `scripts.html`

**HTML Output:**
- Generated: By `hugo` command
- Locations:
  - `public/index.html` (home page)
  - `public/posts/` (post pages)
  - `public/about/index.html` (about page - Hugo creates directory structure)

**Static Files:**
- Copied from: `static/` directory
- Output: To `public/` root (preserving directory structure)
- Cache headers: 1 year for versioned assets (nginx config handles this)

---

*Structure analysis: 2026-01-28*
